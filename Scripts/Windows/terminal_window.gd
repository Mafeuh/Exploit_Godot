extends Control
class_name Terminal

var history := []

@onready var text_input := $VBoxContainer/TextInput
@onready var prompt_feed := $VBoxContainer/Panel/MarginContainer/PromptFeed

var distant_computer: Computer
var previewed_command_index = -1

func _ready() -> void:
	set_process_input(true)

func analyse_command(command: String):
	history.insert(0, command)
	return '[color=indianred][b]Error:[/b] Unknown command.[/color]'

func feed_log(bbcode: String)->void:
	prompt_feed.append_text(str(bbcode, "\n"))

static func feed_log_in_terminal(bbcode: String, terminal: Terminal)->void:
	terminal.feed_log(bbcode)

func _on_text_edit_text_submitted(new_text: String) -> void:
	if new_text == '':
		return
	
	 # Store the submitted command in the history
	history.append(new_text)
	previewed_command_index = -1
	text_input.text = ''
	prompt_feed.append_text('> ' + new_text + '\n')
	self.feed_log("[color=indianred][b]Erreur[/b]: Commande inconnue[/color]")
